{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.17", "generated_at": "2024-07-18T13:35:43.581688Z", "invocation_id": "ea6ddf0f-16fe-4eed-8065-0e0219a322ec", "env": {}}, "results": [{"status": "error", "timing": [{"name": "compile", "started_at": "2024-07-18T13:35:33.974856Z", "completed_at": "2024-07-18T13:35:34.044193Z"}, {"name": "execute", "started_at": "2024-07-18T13:35:34.059076Z", "completed_at": "2024-07-18T13:35:37.402838Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.4708640575408936, "adapter_response": {}, "message": "Database Error in model Tactical_clicks_ytd_12 (models\\example\\Tactical_clicks_ytd_12.sql)\n  1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DELIMITER //\n  CREATE PROCEDURE `Tactical_clicks_months_12_dbt_test`()\n  BEGIN\n      W' at line 12\n  compiled Code at target\\run\\site_dev\\models\\example\\Tactical_clicks_ytd_12.sql", "failures": null, "unique_id": "model.site_dev.Tactical_clicks_ytd_12", "compiled": true, "compiled_code": "\n\n-- \n-- \n-- \nDELIMITER //\nCREATE PROCEDURE `Tactical_clicks_months_12_dbt_test`()\nBEGIN\n    WITH curr_30_days_article_published AS (\n        SELECT siteid, id\n        FROM prod.site_archive_post\n        WHERE date BETWEEN MAKEDATE(EXTRACT(YEAR FROM CURDATE()),1)  and  DATE_SUB(cast(NOW() as date), INTERVAL 1 DAY)\n        AND categories <> \"Nyhedsoverblik\"\n        AND siteid = '14'\n    ),\n    agg_curr_30_days_events AS (\n        SELECT \n            e.siteid AS siteid, \n            SUM(e.hits) AS next_clicks\n        FROM prod.events e\n        JOIN curr_30_days_article_published a ON a.id = e.postid\n        WHERE e.date between MAKEDATE(EXTRACT(YEAR FROM CURDATE()),1)  and  DATE_SUB(cast(NOW() as date), INTERVAL 1 DAY)\n        AND e.siteid = '14'\n        AND e.Event_Action = 'Next Click'\n        GROUP BY 1\n    ),\n    agg_curr_30_days_pages AS (\n        SELECT\n            p.siteid,\n            SUM(p.unique_pageviews) AS pageview_sum\n        FROM prod.pages p\n        LEFT JOIN curr_30_days_article_published a ON a.id = p.postid\n        WHERE p.siteid = '14'\n        AND p.date between MAKEDATE(EXTRACT(YEAR FROM CURDATE()),1)  and  DATE_SUB(cast(NOW() as date), INTERVAL 1 DAY)\n        GROUP BY p.siteid\n    ),\n    value_curr_30_days AS (\n        SELECT\n            e.siteid,\n            ROUND(e.next_clicks / p.pageview_sum * 100, 2) AS value\n        FROM agg_curr_30_days_events e\n        LEFT JOIN agg_curr_30_days_pages p ON e.siteid = p.siteid\n    ),\n    last_30_days_article_published AS (\n        SELECT siteid, id\n        FROM prod.site_archive_post\n        WHERE date between DATE_SUB(MAKEDATE(EXTRACT(YEAR FROM CURDATE()),1), INTERVAL 1 Year)  and DATE_SUB(DATE_SUB(cast(NOW() as date), INTERVAL 1 DAY),INTERVAL 1 Year) \n        AND siteid = site\n        AND categories <> \"Nyhedsoverblik\"\n    ),\n    agg_last_30_days_events AS (\n        SELECT \n            e.siteid AS siteid, \n            SUM(e.hits) AS next_clicks_last\n        FROM prod.events e\n        JOIN last_30_days_article_published a ON a.id = e.postid\n        WHERE e.date between DATE_SUB(MAKEDATE(EXTRACT(YEAR FROM CURDATE()),1), INTERVAL 1 Year) and DATE_SUB(DATE_SUB(cast(NOW() as date), INTERVAL 1 DAY),INTERVAL 1 Year) \n        AND e.siteid = '14'\n        AND e.Event_Action = 'Next Click'\n        GROUP BY 1\n    ),\n    agg_last_30_days_pages AS (\n        SELECT\n            p.siteid,\n            SUM(p.unique_pageviews) AS pageview_sum_last\n        FROM prod.pages p\n        LEFT JOIN last_30_days_article_published a ON a.id = p.postid\n        WHERE p.siteid = '14'\n        AND p.date between DATE_SUB(MAKEDATE(EXTRACT(YEAR FROM CURDATE()),1), INTERVAL 1 Year)  and DATE_SUB(DATE_SUB(cast(NOW() as date), INTERVAL 1 DAY),INTERVAL 1 Year) \n        GROUP BY p.siteid\n    ),\n    value_last_30_days AS (\n        SELECT\n            e.siteid,\n            ROUND(e.next_clicks_last / p.pageview_sum_last * 100, 2) AS value_last\n        FROM agg_last_30_days_events e\n        LEFT JOIN agg_last_30_days_pages p ON e.siteid = p.siteid\n    )\n    SELECT \n        JSON_OBJECT(\n            'site', al.siteid,\n            'data', JSON_OBJECT(\n            'label', 'Gns. next click (%)',\n            'hint', 'Gns. next click p\u00e5 artikler publiceret seneste 30 dage ift. forrige 30 dage',\n            'value', COALESCE(value, 0),\n            'change', COALESCE(value - value_last, 0),\n            'progressCurrent', '',\n            'progressTotal', ''\n            )\n        ) AS json_data\n    FROM value_curr_30_days al\n    LEFT JOIN value_last_30_days alb ON al.siteid = alb.siteid\n    WHERE al.siteid = '14';\nEND;\nDELIMITER ;", "relation_name": "`site_dev`.`Tactical_clicks_ytd_12`"}], "elapsed_time": 20.23323941230774, "args": {"write_json": true, "exclude": [], "partial_parse_file_diff": true, "send_anonymous_usage_stats": true, "log_format_file": "debug", "partial_parse": true, "version_check": true, "cache_selected_only": false, "enable_legacy_logger": false, "introspect": true, "strict_mode": false, "vars": {}, "invocation_command": "dbt run --models Tactical_clicks_ytd_12.sql", "log_level_file": "debug", "which": "run", "warn_error_options": {"include": [], "exclude": []}, "indirect_selection": "eager", "log_format": "default", "select": ["Tactical_clicks_ytd_12.sql"], "project_dir": "E:\\Kasper_Sindri_Media", "print": true, "macro_debugging": false, "log_file_max_bytes": 10485760, "favor_state": false, "populate_cache": true, "require_explicit_package_overrides_for_builtin_materializations": false, "static_parser": true, "profiles_dir": "E:\\Kasper_Sindri_Media", "show_resource_report": false, "use_colors": true, "use_colors_file": true, "log_path": "E:\\Kasper_Sindri_Media\\logs", "log_level": "info", "quiet": false, "printer_width": 80, "defer": false}}